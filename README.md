# bazel_rules_nvc

![Build Status](https://github.com/filmil/bazel_rules_nvc/workflows/Build/badge.svg)

This repository provides [Bazel][baz] build rules for the [NVC compiler and simulator][nvc]. NVC is a VHDL compiler and simulator that aims for VHDL-2019 compliance. These rules allow you to integrate NVC into your Bazel-based VHDL projects, enabling you to build, simulate, and test your VHDL code within the Bazel ecosystem.

[baz]: https://bazel.build
[nvc]: https://github.com/nickg/nvc

## Build Rules

This section documents the Bazel build rules provided in this repository.

### `vhdl_library`

This rule compiles VHDL source files into a library.

**Attributes:**

*   `srcs`: A list of VHDL source files (`.vhdl` or `.vhd`).
*   `deps`: A list of other `vhdl_library` targets that this library depends on.
*   `entities`: A list of VHDL entities provided by this library.
*   `standard`: The VHDL standard to use for compilation (e.g., "2008", "2019"). Defaults to "2019".

### `vhdl_elaborate`

This rule elaborates a VHDL design. Elaboration is the process of creating a design hierarchy from the VHDL code.

**Attributes:**

*   `library`: The `vhdl_library` target to elaborate.
*   `standard`: The VHDL standard to use for elaboration. Defaults to "2019".

### `vhdl_run`

This rule simulates a VHDL design.

**Attributes:**

*   `entity`: The elaborated VHDL entity to simulate. This should be a `vhdl_elaborate` target.
*   `deps`: A list of other `vhdl_library` targets that this simulation depends on.
*   `standard`: The VHDL standard to use for simulation. Defaults to "2019".
*   `use_vcd`: A boolean indicating whether to generate a VCD (Value Change Dump) file for waveform viewing. Defaults to `True`.
*   `args`: A list of additional command-line arguments to pass to the NVC simulator.

### `wave_view`

This rule generates a shell script to view waveforms generated by `vhdl_run`.

**Attributes:**

*   `name`: The name of the target.
*   `vhdl_run`: The `vhdl_run` target that generates the waveform file.
*   `args`: A list of additional arguments to pass to the waveform viewer.
*   `viewer`: The waveform viewer to use (e.g., "gtkwave"). Defaults to "gtkwave".
*   `testonly`: If true, the target is only buildable for tests.
*   `save_file`: A save file for the viewer.

### `produce_waveform`

This rule produces a waveform file from a simulation.

**Attributes:**

*   `simulation`: The simulation target that produces the waveform data.
*   `data`: A list of data files required for the simulation.
*   `args`: A list of additional command-line arguments to pass to the simulation.

### `extract_file`

This rule extracts a specific file from a target.

**Attributes:**

*   `filter`: A string to filter the files in the source target.
*   `src`: The source target to extract the file from.

### `vhdl_test`

This rule defines a VHDL test. It combines the `vhdl_library`, `vhdl_elaborate`, and internal test execution steps into a single macro.

**Attributes:**

*   `name`: The name of the test target.
*   `srcs`: A list of VHDL source files for the test.
*   `deps`: A list of `vhdl_library` targets that this test depends on.
*   `args`: A list of additional command-line arguments to pass to the NVC simulator during the test.
*   `entity`: The VHDL entity to use as the testbench. If not specified, it defaults to `"{name}_tb"`.
